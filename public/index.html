
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>çµæ„›ãƒ•ã‚¡ã‚¤ãƒ«ä¾¿</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    input[type="file"], input[type="text"] { margin: 10px 0; padding: 5px; width: 80%; max-width: 300px; }
    button { padding: 10px 20px; margin-top: 10px; cursor: pointer; }
    a { word-break: break-all; }
  </style>
</head>
<body>
  <h1>ğŸ€ çµæ„›ãƒ•ã‚¡ã‚¤ãƒ«ä¾¿ ğŸ€</h1>
  <form id="uploadForm">
    <input type="file" name="file" required />
    <br>
    <button type="submit">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
  </form>
  <p id="result"></p>

  <input type="text" id="deleteKey" placeholder="å‰Šé™¤ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
  <br>
  <button id="deleteBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹</button>

  <script>
    const form = document.getElementById("uploadForm");
    const result = document.getElementById("result");
    let lastUploadedId = null;
    let lastDeleteKey = null;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      result.textContent = "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­â€¦â³";
      try {
        const res = await fetch("/upload", { method: "POST", body: formData });
        const data = await res.json();
        lastUploadedId = data.id;
        lastDeleteKey = data.deleteKey;
        result.innerHTML = 
          "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼<br>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URL: <a href='/f/" + data.id + "' target='_blank'>/f/" + data.id + "</a><br>" +
          "å‰Šé™¤ã‚­ãƒ¼: <code>" + data.deleteKey + "</code><br>" +
          "å‰Šé™¤ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å®‰å…¨ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚";
        document.getElementById("deleteKey").value = data.deleteKey;
      } catch (e) {
        result.textContent = "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    });

    document.getElementById("deleteBtn").addEventListener("click", async () => {
      const key = document.getElementById("deleteKey").value.trim();
      if (!lastUploadedId) {
        alert("ã¾ã ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã›ã‚“ã€‚");
        return;
      }
      if (!key) {
        alert("å‰Šé™¤ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      try {
        const res = await fetch("/delete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id: lastUploadedId, key }),
        });
        if (res.ok) {
          alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼");
          result.textContent = "";
          lastUploadedId = null;
          lastDeleteKey = null;
          document.getElementById("deleteKey").value = "";
        } else {
          alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å‰Šé™¤ã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        }
      } catch (e) {
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
      }
    });
  </script>
</body>
</html>
